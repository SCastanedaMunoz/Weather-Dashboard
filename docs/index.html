<!DOCTYPE html>
<html lang="en_US">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Weather Dashboard</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
 
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

     <!-- Added link to the jQuery library -->
     <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

     <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>


    <header><strong><h1>Weather Dashboard<h1></strong></header>

    <div class="container-fluid">
        <div class="row">
            <div class="col-3 city-history">
                <div>
                    <h4>Search for a City:</h4>

                    <div class="search-holder input-group mb-3">
                        <input type="text" class="form-control" placeholder="City's Name" aria-label="City's Name" aria-describedby="button-search">
                        <div class="input-group-append">
                          <button class="btn btn-primary" type="button" id="button-search"><i class="fa fa-search" aria-hidden="true"></i></button>
                        </div>
                    </div>

                    <ul class="list-group" id="city-history"></ul>
                </div>
            </div>


            <div class="col-9 city-display" >
                <div class="card fluid">
                    <div class="card-body">
                        <h2 id="city-name" class="city-item"></h2>
                        <div id ="city-temp" class="city-item"></div>
                        <div id ="city-humd" class="city-item"></div>
                        <div id ="city-wind" class="city-item"></div>
                        <div id ="city-uvin" class="city-item"></div>
                    </div>
                  </div>
            </div>
        </div>
    </div>


    <!-- Custom Logic -->
    <script>

        $(document).ready(function(){

            var cityHistory = ["Austin", "Chicago", "New York", "Orlando", "San Francisco", "Seattle", "Denver", "Atlanta"];
            var lastSearchedCity = "Austin";
            const apiKey = "43b58455665ab44ce81cff40a4aa69d9";

            initialize();

            function initialize(){
                fillOutCityHistory();
                renderCity(lastSearchedCity);
            }

            function fillOutCityHistory() {

                // todo - fill with last 8 researched cities

                var cityHistoryList = $("#city-history");
                for (var i = 0; i < cityHistory.length; i ++)
                {
                    var liElement = $("<li>");
                    $(liElement).addClass("list-group-item");

                    if(cityHistory[i] === lastSearchedCity)
                        $(liElement).addClass("active");

                    // todo - add text from storage
                    // todo - set last search city as active
                    $(liElement).text(cityHistory[i]);
                    $(cityHistoryList).append(liElement);
                }
            }

            function renderCity(cityName){
                
                var queryURL = `https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${apiKey}`;

                $.ajax({
                    url : queryURL,
                    method : "GET"
                }).then(function(response){
                    console.log(response);
                    var date = new Date();

                    $("#city-name").text(`${response.name} (${date.getMonth()}/${date.getDate()}/${date.getFullYear()})`);
                    var tempK = response.main.temp;
                    var tempF = (tempK - 273.15) * 9/5 + 32;

                    console
                    $("#city-temp").html(`Temperature: ${tempF.toFixed(0)}&deg;F`);
                    $("#city-humd").html(`Humidity: ${response.main.humidity}%`);
                    $("#city-wind").html(`Wind Speed: ${response.wind.speed} MPH`);

                    fetchUVIndex(response.coord.lat, response.coord.lon);
                });
            }

            function fetchUVIndex(lat, lon){
                var queryURL = `http://api.openweathermap.org/data/2.5/uvi?appid=${apiKey}&lat=${lat}&lon=${lon}`;

                $.ajax({
                    url : queryURL,
                    method : "GET"
                }).then(function(response){
                    console.log(response);
                    $("#city-uvin").html(`UV Index: <button class="btn btn-danger">${response.value}</button>` );
                });
            }
        });

    </script>
  </body>
</html>
